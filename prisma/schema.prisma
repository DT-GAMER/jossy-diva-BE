generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  password      String
  role          UserRole @default(ADMIN)

  bankName      String?
  accountName   String?
  accountNumber String?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

enum UserRole {
  ADMIN
}


model Product {
  id                String   @id @default(uuid())
  name              String
  description       String
  category          ProductCategory

  costPrice         Int
  sellingPrice      Int

  discountType      DiscountType?
  discountValue     Int?
  discountStartAt   DateTime?
  discountEndAt     DateTime?

  quantity          Int
  reservedQuantity  Int      @default(0)

  visibleOnWebsite  Boolean  @default(false)
  isArchived        Boolean  @default(false)
  archivedAt        DateTime?

  media             ProductMedia[]
  orderItems        OrderItem[]
  sales             SaleItem[]

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}


model ProductMedia {
  id        String    @id @default(uuid())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String

  url       String
  publicId  String
  type      MediaType

  createdAt DateTime  @default(now())
}


model Order {
  id          String      @id @default(uuid())
  orderNumber String      @unique

  customerName String
  phone        String

  totalAmount  Int
  status       OrderStatus @default(PENDING_PAYMENT)
  source       SaleSource  @default(WEBSITE)

  items        OrderItem[]

  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
}


model OrderItem {
  id         String   @id @default(uuid())
  order      Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  orderId    String

  product    Product  @relation(fields: [productId], references: [id])
  productId  String

  quantity   Int
  priceAtOrder Int
}


model Sale {
  id            String      @id @default(uuid())
  source        SaleSource
  orderNumber   String?
  customerPhone String?
  receiptNumber String   @unique
  totalAmount   Int
  profit        Int
  paymentMethod PaymentMethod

  items         SaleItem[]

  createdAt     DateTime    @default(now())
}


model SaleItem {
  id         String   @id @default(uuid())
  sale       Sale     @relation(fields: [saleId], references: [id], onDelete: Cascade)
  saleId     String

  product    Product  @relation(fields: [productId], references: [id])
  productId  String

  quantity   Int
  sellingPrice Int
  costPrice    Int
}


enum ProductCategory {
  MEN_CLOTHINGS
  WOMEN_CLOTHINGS
  PERFUMES
  SKIN_CARES
  WATCHES
  JEWELRIES
  FASHION_GLASSES
  BAGS
}

enum DiscountType {
  PERCENTAGE
  FIXED
}

enum MediaType {
  IMAGE
  VIDEO
}

enum OrderStatus {
  PENDING_PAYMENT
  PAID
  CANCELLED
}

enum SaleSource {
  WALK_IN
  WEBSITE
}

enum PaymentMethod {
  CASH
  TRANSFER
}
